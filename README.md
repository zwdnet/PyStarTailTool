Star Trail Generator 🌟

https://img.shields.io/badge/Python-3.6%2B-blue
https://img.shields.io/badge/OpenCV-4.x-green
https://img.shields.io/badge/NumPy-1.19%2B-orange
https://img.shields.io/badge/License-MIT-yellow

一个将星空照片合成为星轨动画的Python程序，生成纯净无干扰的星轨视频和图片。

🤖 本程序由 DeepSeek AI 助手生成，基于用户需求迭代开发完成。

✨ 功能特点

· 永久星轨效果：星星轨迹一旦出现就永久保持，不会衰减消失
· 纯净输出：视频无任何文字、水印、特效干扰
· 高质量图片：自动保存最终星轨的高清JPG图片
· 智能亮度控制：自动调整亮度避免过曝
· 批量处理：支持数百张照片的批量处理
· 自定义参数：可调节帧率、亮度、输出尺寸等
· 进度显示：实时显示处理进度，直观了解处理状态

📸 效果展示

```
输入: 数百张星空照片 → 输出: 星轨动画 + 星轨图片
```

处理效果：

· 视频显示星轨逐渐形成的过程
· 最终图片展示完整的星轨效果
· 所有星星轨迹永久保留

🚀 快速开始

安装依赖

```bash
pip install opencv-python numpy tqdm
```

基本使用

```bash
python star_trail_clean.py <照片文件夹> <输出视频>
```

示例：

```bash
# 处理当前目录的星空照片
python star_trail_clean.py ./星空照片 ./star_trail.mp4

# 处理特定文件夹的照片
python star_trail_clean.py ./photos/night_sky ./my_star_trail.avi
```

完整参数

```bash
python star_trail_clean.py <照片文件夹> <输出视频> [选项]

选项:
  --fps 24        视频帧率 (默认: 25)
  --max 200       最大处理图片数 (默认: 全部)
  --hold 2        最后画面保持秒数 (默认: 2)
  --bright 0.8    亮度系数 (0.5-1.5, 默认: 0.8)
```

📁 输出文件

程序运行后会生成两个文件：

1. 视频文件：输出视频名.mp4
   · 纯净星轨动画，无任何文字干扰
   · 显示星轨逐渐形成的过程
   · 最后保持2秒静止画面
2. 图片文件：输出视频名_star_trail.jpg
   · 最终完整的星轨效果
   · 高质量JPG格式，适合打印和分享
   · 纯净无任何水印或文字

示例输出：

```
star_trail.mp4          # 星轨动画视频
star_trail_star_trail.jpg  # 最终星轨图片
```

⚙️ 参数详解

帧率 (--fps)

· 作用：控制视频播放速度
· 建议值：24-30（电影感）或 15-20（慢速观察）
· 示例：--fps 24 创建电影级帧率

最大图片数 (--max)

· 作用：限制处理的照片数量
· 适用场景：照片太多或只想测试部分照片
· 示例：--max 100 只处理前100张照片

亮度系数 (--bright)

· 作用：控制最终画面的亮度
· 范围：0.5-1.5
· 建议：
  · 0.5-0.7：照片较亮或光污染较多时
  · 0.8-1.0：标准亮度，适合大多数情况
  · 1.1-1.5：照片较暗或想增强星轨效果时

保持时间 (--hold)

· 作用：视频最后静止画面的秒数
· 默认：2秒
· 建议：2-5秒，给观众时间欣赏最终效果

📋 使用建议

准备照片

1. 照片质量：使用RAW或高质量JPG格式
2. 拍摄设置：建议ISO 1600-3200，曝光20-30秒
3. 拍摄间隔：连续拍摄，间隔尽量短
4. 文件命名：按时间顺序命名（如 IMG_001.jpg, IMG_002.jpg）

最佳实践

```bash
# 第一次使用时，先用少量照片测试
python star_trail_clean.py ./test_photos ./test.mp4 --max 50

# 正式处理时，根据照片亮度调整参数
python star_trail_clean.py ./night_photos ./final_trail.mp4 --bright 0.7 --fps 30

# 如果照片很多，可以分批处理
python star_trail_clean.py ./photos_part1 ./trail_part1.mp4 --max 300
```

🔧 技术细节

算法原理

程序使用 纯变亮混合算法（Lighten Blend Mode）：

```python
# 核心算法
star_trail = np.maximum(star_trail, current_image.astype(np.float32))
```

· 每个像素取历史最大值
· 新星星不会覆盖旧轨迹
· 所有轨迹永久保留

处理流程

1. 加载照片：按顺序读取所有星空照片
2. 尺寸调整：统一图片尺寸，保持宽高比
3. 星轨累积：使用变亮混合算法累积星轨
4. 视频生成：将累积过程生成为视频帧
5. 图片保存：保存最终的星轨图片
6. 资源清理：释放内存和文件资源

依赖库

· OpenCV：图像处理和视频编码
· NumPy：高效的数组运算和图像混合
· tqdm：美观的进度条显示

📊 性能优化

内存管理

· 分批处理大量照片，避免内存溢出
· 自动调整图片尺寸，优化处理速度
· 实时释放不再需要的资源

处理速度

· 100张照片：约1-2分钟
· 500张照片：约5-10分钟
· 1000张照片：约15-25分钟

处理时间因电脑配置和照片尺寸而异

❓ 常见问题

Q1: 程序报错 "未找到图片文件"

A: 检查：

1. 文件夹路径是否正确
2. 照片格式是否支持（.jpg, .jpeg, .png, .bmp, .tif）
3. 照片是否损坏

Q2: 视频太暗或太亮

A: 调整 --bright 参数：

· 太暗：增加亮度系数 --bright 1.2
· 太亮：减少亮度系数 --bright 0.6

Q3: 处理过程太慢

A: 尝试：

1. 减少处理照片数量 --max 200
2. 降低输出分辨率（程序会自动缩放）
3. 关闭其他占用资源的程序

Q4: 如何加快视频播放速度？

A: 提高帧率：

```bash
python star_trail_clean.py ./photos ./fast.mp4 --fps 40
```

🛠️ 开发说明

项目结构

```
star_trail_generator/
├── startrail.py           # 主程序（纯净版）
├── README.md              # 说明文档
```

运行环境

· Python 3.6+
· OpenCV 4.x
· NumPy 1.19+
· 支持Windows、macOS、Linux

扩展开发

如需扩展功能，可修改以下部分：

· create_clean_star_trail()：主处理函数
· 混合算法部分：修改星轨累积方式
· 输出格式：支持更多视频/图片格式

📝 版本历史

v1.0 (当前版本)

· 纯净版发布：无任何文字干扰
· 永久星轨效果：轨迹不衰减
· 自动保存最终星轨图片

开发历程

1. 基础版本：实现星轨叠加功能
2. 修复版本：解决静态画面问题
3. 永久轨迹版：轨迹不消失
4. 完整功能版：添加图片保存
5. 纯净最终版：去除所有文字干扰

📄 许可证

MIT License

🙏 致谢

· 感谢：所有星空摄影师提供的美丽素材
· 技术支持：DeepSeek AI助手
· 开源库：OpenCV、NumPy、tqdm

🤝 贡献指南

欢迎提交Issue和Pull Request：

1. Fork本仓库
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建Pull Request

🌟 星空摄影小贴士

1. 拍摄地点：选择光污染少的偏远地区
2. 拍摄时间：新月期间，避开月光干扰
3. 设备要求：三脚架、广角镜头、遥控快门
4. 拍摄参数：高ISO、大光圈、长曝光
5. 后期处理：可以使用本程序生成独特的星轨作品

---

祝您创作出美丽的星轨作品！ ✨📸

如果有任何问题或建议，请提交Issue或联系开发者